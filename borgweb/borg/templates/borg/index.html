<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Borg Summary</title>

    {% load static %}
    {% load compress %}
    {% compress css %}
    <link type="text/x-scss" href="{% static 'theme.scss' %}" rel="stylesheet" media="screen">
    {% endcompress %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" type="text/css" href="{% static 'css/index.css' %}">
    {{ hour_list|json_script:"hour_list" }}
    <script src="{% static 'js/index.js' %}"></script>
    <style>
        body {
            align: center;
        }
    </style>
</head>
<body>
{% if repo_list %}
<div class="container mx-auto d-flex justify-content-center flex-wrap overflow-hidden">
{% for repo in repo_list %}
    <div style="width: 500px;" class="shadow rounded bg-primary overflow-hidden
                {% if not repo.archive_after_latest_error %}bg-danger{% endif %}">
        <div class="row me-1 overflow-hidden text-truncate">
        <h2>{{ repo.label }}
            <small class="text-muted"> {{ repo.location }}</small>
        </h2>
        </div>
        <dl class="row ps-3 overflow-hidden">
            <dt class="col-3">Latest backup:</dt>
            <dd class="col-9">{{ repo.last_backup }}</dd>
        </dl>
        <dl class="row ps-3 overflow-hidden" >
            <dt class="col-3">Hourly backups:</dt>
            <dd class="col-9">{{ repo.hourly_archive_string }}</dd>
        </dl>
        <dl class="row ps-3 overflow-hidden">
            <dt class="col-3">Size:</dt>
            <dd class="col-9">{{ repo.size_string }}</dd>
        </dl>
        {% if repo.recent_errors|length > 0 %}
        <dl class="row">
            <dt class="col-12 h4">Recent errors:</dt>
        </dl>
        {% endif %}
        <dl class="row ps-3">
            {% for error in repo.recent_errors %}
            <dt class="col-3">{{ error.time_ago }}</dt>
            <dd class="col-9 text-truncate">{{ error.error }}</dd>
            {% endfor %}
        </dl>
    </div>
{% endfor %}
<div style="width: 500px;" class="shadow rounded bg-primary overflow-hidden">
    <canvas id="backup_csize_hourly" width="400" height="200"></canvas>
</div>
{% else %}
<p>No repos found.</p>
{% endif %}
</div>
</div>
</body>
</html>